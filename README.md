
# Filmstrip - Production Setup

### 1. Database (Supabase)
Run this SQL in your **SQL Editor** to create all tables. This schema uses `bigint` for timestamps to ensure compatibility with JavaScript's `Date.now()` format:

```sql
-- 1. Users Table (Profile data linked to Auth)
create table if not exists public.users (
  id uuid references auth.users not null primary key,
  email text, 
  "firstName" text, 
  "lastName" text, 
  name text, 
  username text unique,
  "avatarUrl" text, 
  "favoriteGenres" text[], 
  "favoriteMovieId" text,
  "createdAt" bigint not null -- FIXED: Using bigint for Date.now() compatibility
);

-- 2. Movie Entries (Watched, Watchlist, Dropped)
create table if not exists public.entries (
  id bigint generated by default as identity primary key,
  "userId" uuid references auth.users not null, 
  "movieId" text not null,
  status text check (status in ('WATCHED', 'WATCH_LATER', 'DROPPED')),
  rating int, 
  "droppedReason" text, 
  notes text, 
  timestamp bigint
);

-- 3. Friendships
create table if not exists public.friendships (
  id bigint generated by default as identity primary key,
  "userId" uuid references auth.users not null,
  "friendId" uuid references auth.users not null,
  status text check (status in ('PENDING', 'ACCEPTED')),
  unique("userId", "friendId")
);

-- 4. Activity Feed
create table if not exists public.activity (
  id bigint generated by default as identity primary key,
  "userId" uuid references auth.users not null,
  type text, 
  "movieId" text, 
  metadata jsonb, 
  timestamp bigint
);

-- 5. Social Challenges (Battles)
create table if not exists public.challenges (
  id uuid default gen_random_uuid() primary key,
  "creatorId" uuid references auth.users not null,
  "recipientId" uuid references auth.users not null,
  "turnUserId" uuid references auth.users not null,
  type text, 
  size int, 
  status text, 
  "movieIds" text[], 
  results jsonb, 
  config jsonb,
  timestamp bigint
);

-- Disable RLS for MVP (Enable later for production security)
alter table public.users disable row level security;
alter table public.entries disable row level security;
alter table public.friendships disable row level security;
alter table public.activity disable row level security;
alter table public.challenges disable row level security;
```

### 2. Refresh Cache
Settings > **Data API** > Scroll to bottom > **Reload Schema** to apply the bigint changes.

### 3. Vercel Env Vars
- `VITE_SUPABASE_URL`
- `VITE_SUPABASE_ANON_KEY`
- `API_KEY` (Gemini)
